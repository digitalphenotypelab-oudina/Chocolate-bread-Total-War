<div class="stats">
    <h2>SCORE DE GUERRE MONDIAL</h2>
    <div style="font-size: 2rem; color: #f1c40f;">
        PAIN <span id="global-pain">0</span> - <span id="global-choco">0</span> CHOCO
    </div>
    <p>Votes aujourd'hui : <span id="daily-pain">0</span> vs <span id="daily-choco">0</span></p>
</div>

<div id="user-rank" style="margin-top: 20px; padding: 10px; background: #444; border-radius: 10px;">
    Votre Grade : <span id="rank-name" style="color: #f1c40f;">Recrue</span><br>
    Expérience : <span id="user-xp">0</span> XP
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    
    // Récupérer l'XP locale ou démarrer à 0
    let myXP = parseInt(localStorage.getItem('war_xp')) || 0;
    
    function updateRankDisplay() {
        document.getElementById('user-xp').innerText = myXP;
        let rank = "Recrue du pétrin";
        if(myXP >= 5) rank = "Soldat du Beurre";
        if(myXP >= 15) rank = "Capitaine Croissant";
        if(myXP >= 30) rank = "Maréchal de la Mie";
        document.getElementById('rank-name').innerText = rank;
    }

    socket.on('updateScores', (data) => {
        document.getElementById('global-pain').innerText = data.global.pain;
        document.getElementById('global-choco').innerText = data.global.chocolatine;
        document.getElementById('daily-pain').innerText = data.daily.pain;
        document.getElementById('daily-choco').innerText = data.daily.chocolatine;
        updateRankDisplay();
    });

    function castVote(choice) {
        socket.emit('vote', choice);
    }

    socket.on('voteSuccess', () => {
        myXP += 1; // Augmente l'expérience
        localStorage.setItem('war_xp', myXP);
        updateRankDisplay();
        alert("Action héroïque enregistrée ! +1 XP");
        document.querySelectorAll('button').forEach(b => b.disabled = true);
    });

    socket.on('alreadyVoted', () => {
        alert("Reposez-vous soldat, revenez demain !");
        document.querySelectorAll('button').forEach(b => b.disabled = true);
    });

    updateRankDisplay();
</script>
